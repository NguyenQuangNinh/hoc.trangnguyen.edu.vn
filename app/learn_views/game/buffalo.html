"use strict";
$(function(){
{{#error}}
Alert('{{message}}');
{{/error}}
{{^error}}
!function(t,e,n,a,i,o,r,c){n=util.parseInt(n),a=util.parseInt(a);var l,s,u,m=function(t){var e=Math.floor(t/60),n=t-60*e;return e<10&&(e="0"+e),n<10&&(n="0"+n),e+":"+n},f=function(t,e,a){if(3==t){for(var i=0,o=0,r="",c=1;c<=3;c++)e[c]&&(i+=util.parseInt(e[c].score),o+=util.parseInt(e[c].time),r+="Bài: "+c+"- Điểm: "+e[c].score+" - Thời gian: "+m(e[c].time)+"<br/>");r="Tỗng điểm: "+i+"<br/>"+r,r="Tổng thời gian: "+m(o)+"<br/>"+r;var l={};i>150?(l.next={label:"Thi tiếp",className:"btn-warning",callback:function(){window.location.href="../vong-"+(util.parseInt(n)+1)+"/bai-1.html"}},r+="(Bạn được thi vòng tiếp theo)"):(l.rePlay={label:"Thi lại",className:"btn-warning",callback:function(){window.location.href="bai-1.html"}},r+="(Bạn chưa qua vòng này)"),l.exit={label:"Thoát",className:"btn-warning",callback:function(){window.location.href="../.."}},util.DelLocalStore(a),bootbox.dialog({title:"Kết quả vòng thi",message:r,buttons:l})}},h=function(t,e){clearTimeout(u);var i=c.SHA256("{{{type_id}}}-"+n+"-{{{user_id}}}").toString(),o=util.ReadLocalStore(i,{});(o=util.parseJson(o)||{})[a]={score:t,time:e},util.SaveLocalStore(i,o),setTimeout(function(){f(a,o,i)},1e3)},g=parseInt(t.substring(t.length-2)),b=t.substring(0,g),d=JSON.parse(c.AES.decrypt(t.substring(g,t.length-2),"MVT2017"+b).toString(c.enc.Utf8));if(d){var v=util.randomListArray(d.content,d.answers,d.play);if(null!=v){var p={content:v.list_1,time:d.time,timeLeft:d.time,currentAnswers:[],currentScore:0,play:d.play,currentIndex:0,wrongCount:0},w=v.list_2,y=p.currentScore||0,T=p.wrongCount||0;!function(t,e,n){new(0,IGame.core)({container:t,baseUrl:e+"/game/TVUB/",states:[{name:"Boot",state:TVUB.Boot},{name:"Preload",state:TVUB.Preload},{name:"Home",state:TVUB.Home},{name:"Game",state:TVUB.Game},{name:"End",state:TVUB.End}],message:{rule:"Em hãy giúp Trâu vàng điền chữ cái, từ, số, ký hiệu toán học hoặc phép tính phù hợp vào ô trống còn thiếu."},sound:!0,autoLoad:!0,ready:function(t){t.off("boot"),n(t)}})}("#tn-game","",function(t){t.provide("user",{username:"{{user.name}}",uid:"{{user._id}}",avatar:"/avatar/{{user.avatar}}"}),t.on("click.startGame",function(){e(p,function(){l=new Date,t.goState("Game")})}),t.provide("submitAnswer",function(e,n,a){var i=w.shift().toLowerCase()==a.toLowerCase();e({result:i});var o=function(){s=new Date;var e=Math.round((s-l)/1e3);t.goState("End",{score:y,time:p.time,timeLeft:p.time-e}),h(y,e)};i&&100==(y+=10)&&o(),0==w.length&&o()}),t.on("must-finish",function(t){}),t.on("state",function(t){"End"===t.state&&(t.button.hide=!1,t.button.type="dong_y",t.button.callback=function(t){a<3&&(window.location.href="bai-"+(util.parseInt(a)+1)+".html")})});var e=function(e,n){for(var a=e.content,i=0;i<a.length;i++)for(var o=0;o<a[i].length;o++)"latex"==a[i][o].type&&(a[i][o].type="image",a[i][o].content="/latex/"+encodeURI(a[i][o].content));t.setGameData(e),n&&"function"==typeof n&&n()};u=setTimeout(function(){var e=p.time;t.goState("End",{score:y,time:e,timeLeft:0,wrongCount:T}),h(y,e)},1e3*p.timeLeft)})}else Alert("Xin lỗi <br/> đề lỗi hãy báo lại với ban quản trị"),callback(!0,data)}else Alert("không có bài thi cho vòng này")}("{{{exam}}}",0,"{{{round_id}}}","{{{test_id}}}",0,0,0,crt);
{{/error}}
});