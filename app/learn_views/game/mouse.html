"use strict";
$(function(){
{{#error}}
Alert('{{message}}');
{{/error}}
{{^error}}
!function(t,e,n,a,i,o,r,s){n=util.parseInt(n),a=util.parseInt(a);var c,l,u,m=function(t){var e=Math.floor(t/60),n=t-60*e;return e<10&&(e="0"+e),n<10&&(n="0"+n),e+":"+n},g=function(t,e,a){if(3==t){for(var i=0,o=0,r="",s=1;s<=3;s++)e[s]&&(i+=util.parseInt(e[s].score),o+=util.parseInt(e[s].time),r+="Bài: "+s+"- Điểm: "+e[s].score+" - Thời gian: "+m(e[s].time)+"<br/>");r="Tỗng điểm: "+i+"<br/>"+r,r="Tổng thời gian: "+m(o)+"<br/>"+r;var c={};i>150?(c.next={label:"Thi tiếp",className:"btn-warning",callback:function(){window.location.href="../vong-"+(util.parseInt(n)+1)+"/bai-1.html"}},r+="(Bạn được thi vòng tiếp theo)"):(c.rePlay={label:"Thi lại",className:"btn-warning",callback:function(){window.location.href="bai-1.html"}},r+="(Bạn chưa qua vòng này)"),c.exit={label:"Thoát",className:"btn-warning",callback:function(){window.location.href="../.."}},util.DelLocalStore(a),bootbox.dialog({title:"Kết quả vòng thi",message:r,buttons:c})}},f=function(t,e){clearTimeout(u);var i=s.SHA256("{{{type_id}}}-"+n+"-{{{user_id}}}").toString(),o=util.ReadLocalStore(i,{});(o=util.parseJson(o)||{})[a]={score:t,time:e},util.SaveLocalStore(i,o),setTimeout(function(){g(a,o,i)},1e3)},d=parseInt(t.substring(t.length-2)),h=t.substring(0,d),b=JSON.parse(s.AES.decrypt(t.substring(d,t.length-2),"MVT2017"+h).toString(s.enc.Utf8));if(b){for(var v=b.content,p=b.answers,w=[],y=[],T=0;T<v.length;T++){var S=v[T],A=S.number,B=util.randomArray(p[T],A);if(w=w.concat(B),S.is_noisy){v.splice(T,1);for(I=0;I<A;I++)y.push(-1)}else{for(var I=0;I<A;I++)y.push(T);delete v[T].number,delete v[T].is_noisy}}var _=util.randomListArray(w,y,w.length);if(null!=_){var k={content:{categories:v,answers:_.list_1},time:b.time,timeLeft:b.time,currentAnswers:[],currentScore:0,play:b.play,currentIndex:0,wrongCount:0},x=_.list_2,L=k.currentScore||0,U=k.wrongCount||0;!function(t,e,n){new(0,IGame.core)({container:t,baseUrl:e+"/game/CVTB/",states:[{name:"Boot",state:TVUB.Boot},{name:"Preload",state:TVUB.Preload},{name:"Home",state:TVUB.Home},{name:"Game",state:TVUB.Game},{name:"End",state:TVUB.End}],message:{rule:"Hãy kéo ô trống vào giỏ chủ đề, sao cho các nội dung tương đồng hoặc bằng nhau. Sai quá 3 lần bài thi kết thúc."},sound:!0,autoLoad:!0,ready:function(t){t.off("boot"),n(t)}})}("#tn-game","",function(t){t.provide("user",{username:"{{user.name}}",uid:"{{user._id}}",avatar:"/avatar/{{user.avatar}}"}),t.on("click.startGame",function(){e(k,function(){c=new Date,t.goState("Game")})}),t.provide("submitAnswer",function(e,n,a){var i=x[n.index]==a.index;e(i);var o=function(){l=new Date;var e=Math.round((l-c)/1e3);t.goState("End",{score:L,time:k.time,timeLeft:k.time-e,wrongCount:U}),f(L,e)};i?100==(L+=10)&&o():++U>3&&o()}),t.on("must-finish",function(t){console.log("end game:",t)}),t.on("state",function(t){"End"===t.state&&(t.button.hide=!1,t.button.type="dong_y",t.button.callback=function(t){a<3&&(window.location.href="bai-"+(util.parseInt(a)+1)+".html")})});var e=function(e,n){for(var a=e.content.answers,i=0;i<a.length;i++)if("latex"==a[i].type){a[i].type="image";o="/latex/"+encodeURI(a[i].content.replace(/\$/g,""));a[i].content=o}else if("image"==a[i].type){var o=""+a[i].content;a[i].content=o}if(e.currentAnswers&&e.currentAnswers.length>0)for(var r=e.currentAnswers,i=0;i<r.length;i++)r[i]=parseInt(r[i]);t.setGameData(e),n&&"function"==typeof n&&n()};u=setTimeout(function(){var e=k.time;t.goState("End",{score:L,time:e,timeLeft:0,wrongCount:U}),f(L,e)},1e3*k.timeLeft)})}else Alert("Xin lỗi <br/> đề lỗi hãy báo lại với ban quản trị"),callback(!0,data)}else Alert("không có bài thi cho vòng này")}("{{{exam}}}",0,"{{{round_id}}}","{{{test_id}}}",0,0,0,crt);
{{/error}}
});