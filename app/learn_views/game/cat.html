"use strict";
$(function(){
{{#error}}
Alert('{{message}}');
{{/error}}
{{^error}}
!function(t,n,e,a,i,o,r,l){e=util.parseInt(e),a=util.parseInt(a);var c,u,s,m=function(t){var n=Math.floor(t/60),e=t-60*n;return n<10&&(n="0"+n),e<10&&(e="0"+e),n+":"+e},g=function(t,n,a){if(3==t){for(var i=0,o=0,r="",l=1;l<=3;l++)n[l]&&(i+=util.parseInt(n[l].score),o+=util.parseInt(n[l].time),r+="Bài: "+l+"- Điểm: "+n[l].score+" - Thời gian: "+m(n[l].time)+"<br/>");r="Tỗng điểm: "+i+"<br/>"+r,r="Tổng thời gian: "+m(o)+"<br/>"+r;var c={};i>150?(c.next={label:"Thi tiếp",className:"btn-warning",callback:function(){window.location.href="../vong-"+(util.parseInt(e)+1)+"/bai-1.html"}},r+="(Bạn được thi vòng tiếp theo)"):(c.rePlay={label:"Thi lại",className:"btn-warning",callback:function(){window.location.href="bai-1.html"}},r+="(Bạn chưa qua vòng này)"),c.exit={label:"Thoát",className:"btn-warning",callback:function(){window.location.href="../.."}},util.DelLocalStore(a),bootbox.dialog({title:"Kết quả vòng thi",message:r,buttons:c})}},f=function(t,n){clearTimeout(s);var i=l.SHA256("{{{type_id}}}-"+e+"-{{{user_id}}}").toString(),o=util.ReadLocalStore(i,{});(o=util.parseJson(o)||{})[a]={score:t,time:n},util.SaveLocalStore(i,o),setTimeout(function(){g(a,o,i)},1e3)},h=parseInt(t.substring(t.length-2)),d=t.substring(0,h),b=JSON.parse(l.AES.decrypt(t.substring(h,t.length-2),"MVT2017"+d).toString(l.enc.Utf8));if(b){for(var v=[],p=[],w=util.randomArray(b.content,b.play),y=0;y<w.length;y++){v=v.concat(w[y]);for(var T=0;T<2;T++)p.push(y)}var S=util.randomListArray(v,p,v.length);if(null!=S){var B={content:S.list_1,time:b.time,timeLeft:b.time,currentAnswers:[],currentScore:0,play:b.play,currentIndex:0,wrongCount:0},I=S.list_2,x=B.currentScore||0,L=B.wrongCount||0;!function(t,n,e){new(0,IGame.core)({container:t,baseUrl:n+"/game/PTMC/",states:[{name:"Boot",state:TVUB.Boot},{name:"Preload",state:TVUB.Preload},{name:"Home",state:TVUB.Home},{name:"Game",state:TVUB.Game},{name:"End",state:TVUB.End}],message:{rule:"Hãy ghép 2 ô trống chứa nội dung tương đồng hoặc bằng nhau thành cặp đôi. Sai quá 3 lần bài thi kết thúc."},sound:!0,autoLoad:!0,ready:function(t){t.off("boot"),e(t)}})}("#tn-game","",function(t){t.provide("user",{username:"{{user.name}}",uid:"{{user._id}}",avatar:"/avatar/{{user.avatar}}"}),t.on("click.startGame",function(){n(B,function(){c=new Date,t.goState("Game")})}),t.provide("submitAnswer",function(n,e,a){var i=I[e.index]==I[a.index];n(i);var o=function(){u=new Date;var n=Math.round((u-c)/1e3);t.goState("End",{score:x,time:B.time,timeLeft:B.time-n}),f(x,n)};i?100==(x+=10)&&o():++L>3&&o()}),t.on("state",function(t){"End"===t.state&&(t.button.hide=!1,t.button.type="dong_y",t.button.callback=function(t){a<3&&(window.location.href="bai-"+(util.parseInt(a)+1)+".html")})});var n=function(n,e){for(var a=n.content,i=0;i<a.length;i++)for(var o=0;o<a[i].length;o++)"latex"==a[i][o].type&&(a[i][o].type="image",a[i][o].content="/latex/"+encodeURI(a[i][o].content));t.setGameData(n),e&&"function"==typeof e&&e()};s=setTimeout(function(){var n=B.time;t.goState("End",{score:x,time:n,timeLeft:0,wrongCount:L}),f(x,n)},1e3*B.timeLeft)})}else Alert("Xin lỗi <br/> đề lỗi hãy báo lại với ban quản trị"),callback(!0,data)}else Alert("không có bài thi cho vòng này")}("{{{exam}}}",0,"{{{round_id}}}","{{{test_id}}}",0,0,0,crt);
{{/error}}
});