function Second2Minute(n){var t=Math.floor(n/60),i=n-60*t;return 10>t&&(t="0"+t),10>i&&(i="0"+i),t+":"+i}$(function(){function n(){try{var n=util.ReadLocalStore(d,"");if(n&&""!=n){var t=JSON.parse(n);if(t){var i=new Date;return t.expire<i.getTime()?(util.DelLocalStore(d),{}):t}}return{}}catch(e){return console.error(e),{}}}function t(){var n=new Date;n.setSeconds(n.getSeconds()+u),w.expire=n.getTime(),util.SaveLocalStore(d,w)}function e(i,e){r=i.timeLeft||i.time;i.play;if(w=n(),i.content){h=i.content;var a="";$.each(h,function(n,t){a+='<div class="cauhoi">',a+='<p class="tn-question-id"> Câu hỏi '+(n+1)+': <span style="float: right;" id="as-'+n+'"></span></p>';var i=t.question,e=w[n];if(void 0==t.type||"1"==t.type){var o=i.match(/\{img:.+\}/gi);null!=o&&$.each(o,function(n,t){var e=t.substr(5,t.length-6);i=i.replace(t,'<img src="'+e+'"/>')}),o=i.match(/\$(-)?\d*\\\w+\{\d+\}(\{\d+\})?\$/g),null!=o&&$.each(o,function(n,t){var e="/latex/"+encodeURI(t.replace(/\$/g,""));i=i.replace(t,'<img src="'+e+'"/>')});var c=e&&1==e.type?e.value:null;a+='<p class="tn-question">'+i+"</p>",a+='<p class="tn-answer tn-answer-image">',$.each(t.answer,function(t,i){a+="<span>",a+=c&&c==t?'<input qid="'+n+'" id="answer_'+n+"_"+t+'" name="answer_'+n+'" type="radio" value="'+t+'" checked/>':'<input qid="'+n+'" id="answer_'+n+"_"+t+'" name="answer_'+n+'" type="radio" value="'+t+'" />',o=i.match(/\{img:.+\}/gi),null!=o&&$.each(o,function(n,t){var e=t.substr(5,t.length-6);i=i.replace(i,'<img src="'+e+'"/>')}),o=i.match(/\$(-)?\d*\\\w+\{\d+\}(\{\d+\})?\$/g),null!=o&&$.each(o,function(n,t){var e="/latex/"+encodeURI(t.replace(/\$/g,""));i=i.replace(i,'<img src="'+e+'"/>')}),a+='<label for="answer_'+n+"_"+t+'"><span></span>'+i+"</label>",a+="</span>"}),a+="</p>"}if("2"==t.type){var o=i.match(/\{\}/gi),c=e&&2==e.type?e.value:"";null!=o?($.each(o,function(t,e){i=i.replace(e,'<input qid="'+n+'" type="text" value="'+c+'" class="answer_input_'+n+'"/>')}),o=i.match(/\{img:.+\}/gi),null!=o&&$.each(o,function(n,t){var e=t.substr(5,t.length-6);i=i.replace(t,'<img src="'+e+'"/>')}),o=i.match(/\$(-)?\d*\\\w+\{\d+\}(\{\d+\})?\$/g),null!=o&&$.each(o,function(n,t){var e="/latex/"+encodeURI(t.replace(/\$/g,""));i=i.replace(t,'<img src="'+e+'"/>')}),a+='<p class="tn-question">'+i+"</p>"):a+='<p class="tn-question"><span style="color:red">#Error</span></p>'}a+="</div>"}),v.html(a),v.find('.cauhoi input[type="text"]').change(function(){var n=$(this),i=n.attr("qid");w[i]={value:n.val(),type:2},t()}),v.find('.cauhoi input[type="radio"]').click(function(){var n=$(this),i=n.attr("qid");w[i]={value:n.val(),type:1},t()})}c(r),e&&"function"==typeof e&&e()}function a(){TN_POPUP.hide()}function o(){if(!p)return!1;clearInterval(s);var n=[];return $.each(h,function(t,i){var e="";if(void 0==i.type||"1"==i.type){var a=$("input[type='radio'][name='answer_"+t+"']:checked");a.length>0&&(e=a.val())}if("2"==i.type)var e=$(".answer_input_"+t).val();n.push(e)}),_.emit("submitAnswer",{answers:n},function(n){if(n.error)TN_POPUP.show(n.message,null,null,null,null,null,!1);else if(util.DelLocalStore(d),n.list_answer){var t=n.list_answer,e=h.length;for(i=0;i<e;i++)$("#as-"+i).text(t[i]?"(Đúng)":"(sai)");v.find("input").prop("disabled",!0)}}),!1}function c(n){u=n,s=setInterval(function(){u--,0>=u&&(clearInterval(s),m.click()),g.html(Second2Minute(u))},1e3)}TN_POPUP.show("Đang kết nối với máy chủ...","Kết nối",null,null,null,!1);var l,r,u,s,h,d,p=!0,f=!1,v=$("#div_questions"),g=$("#tn-count-down"),m=$("#bt_endgame"),w={},_=io();_.on("connect",function(){TN_POPUP.hide()}),_.on("server-ready",function(n,t){t({"client-ready":!0,width:screen.width,height:screen.height}),d=n.key_store}),_.on("server-msg",function(n){p=!1,TN_POPUP.show(n.message)}),_.on("socket-ready",function(n){0==n.error?void 0==l&&(l={},bottons=[{caption:"Bắt đầu",callback:function(){_.emit("getdata",{a:"mvt",b:"2015"},function(n){0==n.error?e(n.data,function(){a()}):(p=!1,TN_POPUP.show(n.message))})}},{caption:"Thoát",callback:function(){window.location.href="/"}}],TN_POPUP.show("Em hãy đọc kỹ câu hỏi và ĐIỀN vào chỗ trống hoặc CHỌN 1 trong 4 đáp án cho sẵn. Nếu CHỌN đáp án em hãy click chuột vào ô tròn trước đáp án. Nếu ĐIỀN vào chỗ trống, em hãy ĐIỀN chữ cái, từ, số, ký hiệu toán học, hoặc phép tính. Chú ý, phân số em ĐIỀN theo dạng a/b.Nếu là số thập phân em dùng dấu chấm, ví dụ 1.25 và sau khi làm xong 10 câu hỏi em ấn nút nộp bài.<br/>Bạn đã sãn sàng chưa?","Bắt đầu",600,280,bottons,null,!1)):(p=!1,TN_POPUP.show(n.message,"Cảnh báo",null,null,null,null,!1),_.close())}),_.on("onData",function(n){0==n.error?e(n.data):TN_POPUP.show(n.message)}),_.on("onStart",function(){a()}),_.on("onEnd",function(n){if(f=!0,n.data_round){var t=n.data_round,e="";if(t.luot>1&&(e+="Lượt thi: "+t.luot+"<br/>"),e+="Tỗng điểm: "+t.total_score+"<br/>",e+="Tổng thời gian: "+t.total_time+"<br/>",t.round_info&&t.round_info.length>0){var a=n.data_round.round_info;for(i=0;i<a.length;i++)e+="Bài: "+(i+1)+"- Điểm: "+a[i].score+" - Thời gian: "+a[i].total_time+"<br/>"}var o=[];n.pass_round?(o.push({caption:"Thi tiếp",callback:function(){window.location.href="../vong-"+(n.round_id+1)+"/bai-1"}}),e+="(Bạn được thi vòng tiếp theo)"):(o.push({caption:"Thi lại",callback:function(){window.location.href="bai-1"}}),e+="(Bạn chưa qua vòng này)"),o.push({caption:"Đáp án",callback:function(){TN_POPUP.hide(),n.pass_round?m.text("Thi tiếp").unbind("click").click(function(){window.location.href="../vong-"+(n.round_id+1)+"/bai-1"}):m.text("Thi lại").unbind("click").click(function(){window.location.href="bai-1"})}}),o.push({caption:"Thoát",callback:function(){window.location.href="/"}}),TN_POPUP.show(e,"Thông tin vòng thi "+n.round_id,400,280,o,null,!1)}else{var e="Bạn thi được: "+n.score+" điểm<br/>";e+="Thời gian: "+Second2Minute(n.time-n.timeLeft);var o=[{caption:"Thi tiếp",callback:function(){window.location.href=n.next_url}},{caption:"Đáp án",callback:function(){TN_POPUP.hide(),m.text("Thi tiếp").unbind("click").click(function(){window.location.href=n.next_url})}}];TN_POPUP.show(e,null,null,null,o,null,!1)}}),_.on("disconnect",function(){p&&!f&&TN_POPUP.show("Đã ngắt kết nối với máy chủ...","Lỗi kết nối",null,null,null,null,!1)}),m.click(function(){return o()})});