var div_questions=$("#div_questions"),count_down=$("#count_down"),bt_endgame=$("#bt_endgame"),type_id="{{{type_id}}}",round_id=util.parseInt("{{{round_id}}}"),test_id=util.parseInt("{{{test_id}}}"),user_id="{{{user_id}}}",t1,t2,tt,itv,lq,law,key_store="",setData=function(t,n){tt=t.time,t1=t.timeLeft||t.time;var e=getDataLocal();if(t.content){lq=t.content;var i="";$.each(lq,function(t,n){i+="<article>",i+="<h3> Câu hỏi "+(t+1)+':</h3><div class="full-right" id="as-'+t+'"></div>';var a=n.question,l=e[t];if(void 0==n.type||"1"==n.type){null!=(c=a.match(/\{img:.+\}/gi))&&$.each(c,function(t,n){var e=n.substr(5,n.length-6);a=a.replace(n,'<img src="'+e+'"/>')}),null!=(c=a.match(/\$(-)?\d*\\\w+\{\d+\}(\{\d+\})?\$/g))&&$.each(c,function(t,n){var e="/latex/"+encodeURI(n.replace(/\$/g,""));a=a.replace(n,'<img src="'+e+'"/>')});r=l&&1==l.type?l.value:null;i+="<p>"+a+"</p>",$.each(n.answer,function(n,e){i+='<div class="radio icheck-wisteria">',i+=r&&r==n?'<input qid="'+t+'" id="answer_'+t+"_"+n+'" name="answer_'+t+'" type="radio" value="'+n+'" checked/>':'<input qid="'+t+'" id="answer_'+t+"_"+n+'" name="answer_'+t+'" type="radio" value="'+n+'" />',null!=(c=e.match(/\{img:.+\}/gi))&&$.each(c,function(t,n){var i=n.substr(5,n.length-6);e=e.replace(e,'<img src="'+i+'"/>')}),null!=(c=e.match(/\$(-)?\d*\\\w+\{\d+\}(\{\d+\})?\$/g))&&$.each(c,function(t,n){var i="/latex/"+encodeURI(n.replace(/\$/g,""));e=e.replace(e,'<img src="'+i+'"/>')}),i+='<label for="answer_'+t+"_"+n+'"><span></span>'+e+"</label>",i+="</div>"})}if("2"==n.type){var c=a.match(/\{\}/gi),r=l&&2==l.type?l.value:"";null!=c?($.each(c,function(n,e){a=a.replace(e,'<input qid="'+t+'" type="text" value="'+r+'" class="answer_input_'+t+'"/>')}),null!=(c=a.match(/\{img:.+\}/gi))&&$.each(c,function(t,n){var e=n.substr(5,n.length-6);a=a.replace(n,'<img src="{{{server_upload}}}'+e+'"/>')}),null!=(c=a.match(/\$(-)?\d*\\\w+\{\d+\}(\{\d+\})?\$/g))&&$.each(c,function(t,n){var e="/latex/"+encodeURI(n.replace(/\$/g,""));a=a.replace(n,'<img src="'+e+'"/>')}),i+='<p class="tn-question">'+a+"</p>"):i+='<p class="tn-question"><span style="color:red">#Error</span></p>'}i+="</article>"}),div_questions.html(i),tRun(t1),n&&"function"==typeof n&&n()}else Alert("Không có nội dung bài thi")},endGame=function(t,n){if(3==test_id){for(var e=0,i=0,a="",l=1;l<=3;l++)t[l]&&(e+=util.parseInt(t[l].score),i+=util.parseInt(t[l].time),a+="Bài: "+l+"- Điểm: "+t[l].score+" - Thời gian: "+t[l].time+"<br/>");a="Tỗng điểm: "+e+"<br/>"+(a="Tổng thời gian: "+i+"<br/>"+a);var c={};e>150?(c.next={label:"Thi tiếp",className:"btn-warning",callback:function(){window.location.href="../vong-"+(util.parseInt(round_id)+1)+"/bai-1.html"}},a+="(Bạn được thi vòng tiếp theo)"):(c.rePlay={label:"Thi lại",className:"btn-warning",callback:function(){window.location.href="bai-1.html"}},a+="(Bạn chưa qua vòng này)"),c.exit={label:"Thoát",className:"btn-warning",callback:function(){window.location.href="../.."}},util.DelLocalStore(n),bootbox.dialog({title:"Kết quả vòng thi",message:a,buttons:c})}else{a="Bạn thi được: "+t[test_id].score+" điểm<br/>";a+="Thời gian: "+s2m(t[test_id].time),bootbox.dialog({title:"Kết quả bài thi",message:a,buttons:{next:{label:"Thi tiếp",className:"btn-warning",callback:function(){window.location.href="bai-"+(util.parseInt(test_id)+1)+".html"}},view:{label:"Đáp án",className:"btn-warning",callback:function(){bt_endgame.text("Thi tiếp").unbind("click").click(function(){window.location.href="bai-"+util.parseInt(test_id+1)+".html"})}}}})}},nopBai=function(){clearInterval(itv),div_questions.find("input").prop("disabled",!0);var t=0;$.each(lq,function(n,e){var i="";if(void 0==e.type||"1"==e.type){var a=$("input[type='radio'][name='answer_"+n+"']:checked");a.length>0&&(i=a.val())}"2"==e.type&&(i=$(".answer_input_"+n).val());var l=i.toLocaleLowerCase()==law[n].toLocaleLowerCase();l&&(t+=10),$("#as-"+n).text(l?"(Đúng)":"(sai)")});var n=crt.SHA256(type_id+"-"+round_id+"-"+user_id).toString(),e=util.ReadLocalStore(n,{});return(e=util.parseJson(e))||(e={}),e[test_id]={score:t,time:tt-t2},util.SaveLocalStore(n,e),endGame(e,n),!1},getDataLocal=function(){return{}},rla=function(t,n,e){if(t&&n){if(e<=t.length){for(var i=[],a=[],l=t.slice(),c=n.slice(),r=0;r<e;r++){var o=Math.floor(Math.random()*l.length);i.push(l[o]),a.push(c[o]),l.splice(o,1),c.splice(o,1)}return{l1:i,l2:a}}return null}return null},tRun=function(t){t2=t,itv=setInterval(function(){--t2<=0&&(clearInterval(itv),nopBai()),count_down.text(s2m(t2))},1e3)},s2m=function(t){var n=Math.floor(t/60),e=t-60*n;return n<10&&(n="0"+n),e<10&&(e="0"+e),n+":"+e};!function(t,n){var e=parseInt(t.substring(t.length-2)),i=t.substring(0,e),a=JSON.parse(n.AES.decrypt(t.substring(e,t.length-2),"MVT2017"+i).toString(n.enc.Utf8));(i=rla(a.content,a.answers,a.play))?(law=i.l2,a.content=i.l1,Alert("Bắt đầu làm bài nào!","Bạn đã sẵn sàng chưa?",function(){setData(a,function(){bt_endgame.prop("disabled",!1).click(function(){Confirm("Bạn chắc chắn muốn nộp bài chứ?","Xác nhận",function(t){t&&nopBai()})})})})):Alert("Không chọn được câu hỏi")}("{{{exam}}}",crt);